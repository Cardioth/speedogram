<!DOCTYPE html>
<html>
<title>Speed-o-gram</title>
<style>
#speedogram {
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-top: 20px;
}
</style>
<body>
<canvas id="speedogram" width="400" height="400">Hello</canvas>
</body>

<script>
var lives = 3;
var gridSize = 5;
var cellSize = 20;
var gridBoundaryMargin = 75;
var overallGridSize = gridSize*cellSize;
var gridOffSetX = (400-overallGridSize)/2;
var gridOffSetY = 120;
var mouseState = "up";
var mouseButton;


var grid = [];
var gridGuesses = [];

var can = document.getElementById("speedogram");

can.addEventListener("mousemove", mouseMove, false);
can.addEventListener("mouseup", mouseUp, false);
can.addEventListener("mousedown", mouseDown, false);

var ctx = can.getContext("2d");
var mouseX;
var mouseY;

function renderCross(x,y){
  let p = new Path2D('M 16.4 10.5 L 14.5 8.65 12.6 10.55 10.7 8.65 8.8 10.5 10.7 12.45 8.8 14.35 10.7 16.25 12.6 14.3 14.5 16.25 16.4 14.35 14.5 12.45 16.4 10.5 Z');
  ctx.translate(x,y);
  ctx.fillStyle = "#0088FF"
  ctx.fill(p);
  ctx.translate(-x,-y);
}

function renderHeart(x,y){
  let p = new Path2D('M 24.1 7.05 Q 24.1 4.65 22.4 2.95 21.4 1.95 20.1 1.55 19.25 1.25 18.3 1.25 15.9 1.25 14.2 2.95 12.55 4.6 12.5 7 12.45 4.6 10.8 2.95 9.15 1.3 6.85 1.25 6.8 1.25 6.7 1.25 4.3 1.25 2.6 2.95 0.9 4.65 0.9 7.05 0.9 9 2.15 10.65 L 12.5 23.8 22.3 11.75 Q 24.1 9.45 24.1 7.05 Z');
  ctx.translate(x,y);
  ctx.fillStyle = "#FF5555"
  ctx.fill(p);
  ctx.translate(-x,-y);
}

function renderHealth(){
  for(var livesCount = 0;livesCount<lives;livesCount++){
    renderHeart((livesCount*25)+175-(lives*12.5),gridOffSetY+overallGridSize+25);
  }
}

can.oncontextmenu = function (e) {
    e.preventDefault();
};

function renderMouseOver(){
  for(var i = 0; i<gridSize;i++){
    for(var j = 0; j<gridSize;j++){
      //check if mouse is over cell
      if(mouseX > i*cellSize+gridOffSetX && mouseX < i*cellSize+cellSize+gridOffSetX && mouseY > j*cellSize+gridOffSetY && mouseY < j*cellSize+cellSize+gridOffSetY){
        ctx.globalAlpha = 0.2;
        ctx.fillStyle = "#0088FF";
        ctx.roundRect(i*cellSize+gridOffSetX,j*cellSize+gridOffSetY,cellSize,cellSize, 3,true,false);
      }
      ctx.globalAlpha = 1;
    }
  }
}

function renderBackdrop(){
  ctx.globalAlpha = 0.1;
  ctx.fillStyle = "#0088FF";
  ctx.roundRect(gridOffSetX-gridBoundaryMargin,gridOffSetY-gridBoundaryMargin,overallGridSize+(gridBoundaryMargin+15),overallGridSize+(gridBoundaryMargin+15), 5,true,false);
  ctx.globalAlpha = 1;
  ctx.strokeStyle = "#0088FF";
  ctx.lineWidth = .75;
  ctx.roundRect(gridOffSetX-gridBoundaryMargin,gridOffSetY-gridBoundaryMargin,overallGridSize+(gridBoundaryMargin+15),overallGridSize+(gridBoundaryMargin+15), 5,false,true);
}
function renderTitle(){
  ctx.font = "24px Arial";
  ctx.fillStyle = "#0088FF";
  ctx.fillText("Speed-o-Gram",93,25);
}
function renderClueText(){
  for (var counts in Xcounters){
    for(var seg in Xcounters[counts]){
      ctx.font = "11px Arial";
      ctx.fillStyle = "#0088FF";
      ctx.fillText(Xcounters[counts][Xcounters[counts].length-seg-1], gridOffSetX+(cellSize/4)+(counts*cellSize), gridOffSetY-10-(seg*15));
    }
  }
  for (var counts in Ycounters){
    for(var seg in Ycounters[counts]){
      ctx.font = "11px Arial";
      ctx.fillStyle = "#0088FF";
      ctx.fillText(Ycounters[counts][Ycounters[counts].length-seg-1], gridOffSetX-(seg*15)-14, gridOffSetY+6+(cellSize/4)+(counts*cellSize));
    }
  }
}
function actionCell(){
	if(mouseState == "down"){
		for(var i = 0; i<gridSize;i++){
			for(var j = 0; j<gridSize;j++){
				if(mouseX > i*cellSize+gridOffSetX && mouseX < i*cellSize+cellSize+gridOffSetX && mouseY > j*cellSize+gridOffSetY && mouseY < j*cellSize+cellSize+gridOffSetY){
					if(grid[i][j] == 1 && gridGuesses[i][j] != 1){
					  gridGuesses[i][j] = 1;
					  if(mouseButton != 0){
						lives --;
						gameOverScreen();
					  } else {
						//adds up number of correct guesses
						var columnGuesses = 0;
						var rowGuesses = 0;
						for(var k = 0; k<gridSize;k++){
							if(grid[i][k] == 1 && gridGuesses[i][k] == 1){
								columnGuesses ++;
							}
							if(grid[k][j] == 1 && gridGuesses[k][j] == 1){
								rowGuesses ++;
							}
						}
						//checks if number of correct guesses is the same as the total number of filled cells for that row
						if(columnGuesses == columnsTotal[i]){
							for(var l = 0; l<gridSize;l++){
								gridGuesses[i][l] = 1;
							}
						}
						if(rowGuesses == rowsTotal[j]){
							for(var m = 0; m<gridSize;m++){
								gridGuesses[m][j] = 1;
							}
						}
					  }
					}
					if(grid[i][j] == 0 && gridGuesses[i][j] != 1) {
					  gridGuesses[i][j] = 1;
					  if(mouseButton != 2){
						lives --;
						gameOverScreen();
					  }
					}
				}
			}
		}
	}
}

function draw(){
  actionCell();
  ctx.clearRect(0,0,400,400);
  renderBackdrop();
  renderCells();
  renderTitle();
  renderClueText();
  renderMouseOver();
  renderHealth();
  window.requestAnimationFrame(draw);

}

function mouseMove(){
    mouseX = event.clientX - can.offsetLeft;
    mouseY = event.clientY - can.offsetTop;
}
function gameOverScreen(){
    if(lives == 0){
     lives = 3;
	    alert("You lose bucko!");
      init();
      mouseState = "up";
      mouseButton = 0;
    }
}

function checkVictory(){
  var totalGridSize = gridSize*gridSize;
  var totalGuesses = 0;
    for(var i = 0; i<gridSize;i++){
      for(var j = 0; j<gridSize;j++){
        if(gridGuesses[i][j] == 1){
          totalGuesses ++;
        }
      }
    }
  if(totalGuesses == totalGridSize){
    alert("Victory");
  	init();
    mouseState = "up";
    mouseButton = 0;
  }
}

function mouseDown(){
	mouseState = "down";
	mouseButton = event.button;
}
function mouseUp(){
	mouseState = "up";
	mouseButton = event.button;
	checkVictory();
}

CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius, fill, stroke) {
    var cornerRadius = { upperLeft: 0, upperRight: 0, lowerLeft: 0, lowerRight: 0 };
    if (typeof stroke == "undefined") {
        stroke = true;
    }

    if (typeof radius === "object") {
        for (var side in radius) {
            cornerRadius[side] = radius[side];
        }
    }
	if (typeof radius === "number"){
		for (var side in cornerRadius) {
            cornerRadius[side] = radius;
        }
	}

    this.beginPath();
    this.moveTo(x + cornerRadius.upperLeft, y);
    this.lineTo(x + width - cornerRadius.upperRight, y);
    this.quadraticCurveTo(x + width, y, x + width, y + cornerRadius.upperRight);
    this.lineTo(x + width, y + height - cornerRadius.lowerRight);
    this.quadraticCurveTo(x + width, y + height, x + width - cornerRadius.lowerRight, y + height);
    this.lineTo(x + cornerRadius.lowerLeft, y + height);
    this.quadraticCurveTo(x, y + height, x, y + height - cornerRadius.lowerLeft);
    this.lineTo(x, y + cornerRadius.upperLeft);
    this.quadraticCurveTo(x, y, x + cornerRadius.upperLeft, y);
    this.closePath();
    if (stroke) {
        this.stroke();
    }
    if (fill) {
        this.fill();
    }
}
var Xcounters = [];
var Ycounters = [];
var columnsTotal = [];
var rowsTotal = [];

function init(){
	//reset main values
	grid = [];
	gridGuesses = [];
	Xcounters = [];
	Ycounters = [];
	columnsTotal = [];
	rowsTotal = [];


  for(var i = 0; i<this.gridSize;i++){
    var gridX = [];
    var gridGuessesX = [];
    for(var j = 0; j<this.gridSize;j++){
      var randomNumber = Math.floor(Math.random()*3);
      if (randomNumber>1){randomNumber=1;}
      gridX.push(randomNumber);
      gridGuessesX.push(0);
    }
    grid.push(gridX);
    gridGuesses.push(gridGuessesX);
  }

  //builds clues and row column total arrays
  for(var i = 0; i<this.gridSize;i++){
    var column = [];
    var count = 0;
	var countTotal =0;
    for(var j = 0; j<this.gridSize;j++){
      if(grid[i][j] == 1){
        count ++;
		countTotal ++;
      } else {
        if(count > 0){
          column.push(count);
          count = 0;
        }
      }
    }
    if(count > 0){
      column.push(count);
    }
	columnsTotal.push(countTotal);
    Xcounters.push(column);
  }
  for(var i = 0; i<this.gridSize;i++){
    var row = [];
    var count = 0
	var countTotal = 0;
    for(var j = 0; j<this.gridSize;j++){
      if(grid[j][i] == 1){
        count ++;
		countTotal ++;
        if(j == this.gridSize-1){
          row.push(count);
        }
      } else {
        if(count != 0){
          row.push(count);
          count = 0;
        }
      }
    }
	rowsTotal.push(countTotal);
    Ycounters.push(row);
  }
}

function renderCells(){
  for(var i = 0; i<this.gridSize;i++){
    for(var j = 0; j<this.gridSize;j++){
      ctx.lineWidth = 1;
      ctx.strokeStyle = "#0088FF";
      ctx.fillStyle = "#FFFFFF";
      ctx.roundRect(i*cellSize+gridOffSetX,j*cellSize+gridOffSetY,cellSize,cellSize, 3,true,true);
      if(gridGuesses[i][j] == 1 && grid[i][j] == 1){
        ctx.fillStyle = "#0088FF";
        ctx.roundRect(i*cellSize+gridOffSetX,j*cellSize+gridOffSetY,cellSize,cellSize, 3,true,false);
      }
      if(gridGuesses[i][j] == 1 && grid[i][j] == 0){
        renderCross(i*cellSize+gridOffSetX-3,j*cellSize+gridOffSetY-3);
      }
    }
  }
}

init();
draw();

</script>

</html>
